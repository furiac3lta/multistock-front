<div class="log-container">

  <div class="header mat-elevation-z2" style="padding:12px; display:flex; justify-content:space-between; align-items:center;">
    <h2>Auditoría de movimientos</h2>

    <mat-form-field appearance="outline" style="width:280px;">
      <mat-label>Buscar por cualquier dato...</mat-label>
      <input matInput [(ngModel)]="search" (input)="filter()">
    </mat-form-field>
  </div>

  <table mat-table [dataSource]="filtered" class="mat-elevation-z2 full-width">

    <!-- Fecha -->
    <ng-container matColumnDef="createdAt">
      <th mat-header-cell *matHeaderCellDef> Fecha </th>
      <td mat-cell *matCellDef="let l"> {{ l.createdAt | date:'short' }} </td>
    </ng-container>

    <!-- Usuario -->
    <ng-container matColumnDef="username">
      <th mat-header-cell *matHeaderCellDef> Usuario </th>
      <td mat-cell *matCellDef="let l"> {{ l.username }} </td>
    </ng-container>

    <!-- Producto -->
    <ng-container matColumnDef="productName">
      <th mat-header-cell *matHeaderCellDef> Producto </th>
      <td mat-cell *matCellDef="let l"> {{ l.productName }} </td>
    </ng-container>

    <!-- Acción -->
    <ng-container matColumnDef="movementType">
      <th mat-header-cell *matHeaderCellDef> Acción </th>
      <td mat-cell *matCellDef="let l">
        <span [ngClass]="{
          'tag-inc': (l.movementType || '').startsWith('TRANSFER_IN') || (l.movementType || '').endsWith('INCREASE'),
          'tag-dec': (l.movementType || '').startsWith('TRANSFER_OUT') || (l.movementType || '').endsWith('DECREASE')
        }">
          {{ l.movementType || '-' }}
        </span>
      </td>
    </ng-container>

    <!-- Cantidad -->
    <ng-container matColumnDef="quantity">
      <th mat-header-cell *matHeaderCellDef> Cantidad </th>
      <td mat-cell *matCellDef="let l"> {{ l.quantity }} </td>
    </ng-container>

    <!-- Descripción -->
    <ng-container matColumnDef="description">
      <th mat-header-cell *matHeaderCellDef> Descripción </th>
      <td mat-cell *matCellDef="let l"> {{ l.description || '-' }} </td>
    </ng-container>

    <!-- Origen -->
    <ng-container matColumnDef="originBranchName">
      <th mat-header-cell *matHeaderCellDef> Sucursal Origen </th>
      <td mat-cell *matCellDef="let l"> {{ l.originBranchName || '-' }} </td>
    </ng-container>

    <!-- Destino -->
    <ng-container matColumnDef="branchName">
      <th mat-header-cell *matHeaderCellDef> Sucursal Destino </th>
      <td mat-cell *matCellDef="let l"> {{ l.branchName }} </td>
    </ng-container>

    <!-- Antes -->
    <ng-container matColumnDef="beforeStock">
      <th mat-header-cell *matHeaderCellDef> Antes </th>
      <td mat-cell *matCellDef="let l"> {{ l.beforeStock }} </td>
    </ng-container>

    <!-- Después -->
    <ng-container matColumnDef="afterStock">
      <th mat-header-cell *matHeaderCellDef> Después </th>
      <td mat-cell *matCellDef="let l"> {{ l.afterStock }} </td>
    </ng-container>

    <!-- IP -->
    <ng-container matColumnDef="ip">
      <th mat-header-cell *matHeaderCellDef> IP </th>
      <td mat-cell *matCellDef="let l"> {{ l.ip }} </td>
    </ng-container>

    <!-- Header y Rows -->
    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

  </table>

</div>
