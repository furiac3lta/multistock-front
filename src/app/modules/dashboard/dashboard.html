<div class="dashboard-container">
  <div class="top-grid">
    <div class="intro-card">
      <div class="eyebrow">Resumen General</div>
      <div class="title-row">
        <h1>Dashboard</h1>
        <span class="badge">Inventario al día</span>
      </div>
      <p class="subtitle">
        Control rápido de inventario, movimientos y actividad reciente.
      </p>

      <div class="chip-row" *ngIf="branches.length">
        <span class="chip-label">Sucursales</span>
        <mat-chip-listbox class="branch-chips" aria-label="Sucursales" selectable>
          <mat-chip-option
            *ngFor="let branch of branches"
            [selected]="branch.id === currentBranch"
            (click)="changeBranch(branch.id)"
          >
            {{ branch.name }}
          </mat-chip-option>
        </mat-chip-listbox>
      </div>
    </div>

    <div class="metrics-grid">
      <div class="stat-card accent-iris">
        <p class="label">Productos</p>
        <p class="value">{{ totalProductos }}</p>
        <span class="hint">Productos en la sucursal</span>
      </div>

      <div class="stat-card accent-amber">
        <p class="label">Categorías</p>
        <p class="value">{{ totalCategorias }}</p>
        <span class="hint">Organización del catálogo</span>
      </div>

      <div class="stat-card accent-coral">
        <p class="label">Valor Inventario</p>
        <p class="value">{{ valorInventario | currency:'ARS':'symbol':'1.0-0' }}</p>
        <span class="hint">Stock estimado de venta</span>
      </div>

      <div class="stat-card accent-mint">
        <p class="label">Stock Total</p>
        <p class="value">{{ totalStock }}</p>
        <span class="hint">Unidades en existencia</span>
      </div>

      <div class="stat-card accent-night">
        <p class="label">Movimientos Hoy</p>
        <p class="value">{{ totalMovimientosHoy }}</p>
        <span class="hint">Ingresos y salidas registradas</span>
      </div>
    </div>
  </div>

  <div class="panel-grid">
    <div class="panel">
      <div class="panel-header">
        <div>
          <p class="eyebrow">Stock Bajo</p>
          <h3>Stock &lt;= 5</h3>
        </div>
      </div>
      <div *ngIf="stockBajo.length === 0" class="empty">No hay productos con stock bajo</div>
      <ul *ngIf="stockBajo.length > 0" class="item-list">
        <li *ngFor="let p of stockBajo">
          <div class="item-title">{{ p.name }}</div>
          <span class="pill warning">Stock {{ p.stock }}</span>
        </li>
      </ul>
    </div>

    <div class="panel">
      <div class="panel-header">
        <div>
          <p class="eyebrow">Últimos Productos</p>
          <h3>Últimos ingresados</h3>
        </div>
      </div>
      <ul class="item-list">
        <li *ngFor="let p of ultimosProductos">
          <div class="item-title">{{ p.name }}</div>
          <span class="pill info">{{ p.salePrice | currency:'ARS':'symbol':'1.0-0' }}</span>
        </li>
      </ul>
    </div>

    <div class="panel wide">
      <div class="panel-header">
        <div>
          <p class="eyebrow">Últimos Movimientos</p>
          <h3>Actividad reciente</h3>
        </div>
      </div>
      <ul class="item-list movements">
        <li *ngFor="let m of ultimosMovimientos">
          <div class="movement-meta">
            <span class="date">{{ m.createdAt | date:'dd/MM' }}</span>
            <span class="hour">{{ m.createdAt | date:'HH:mm' }}</span>
          </div>
          <div class="movement-detail">
            <div class="item-title">{{ m.productName }}</div>
            <div class="pill-group">
              <span class="pill" [class.success]="m.movementType === 'INCREASE'" [class.danger]="m.movementType === 'DECREASE'">
                {{ m.movementType === 'INCREASE' ? 'Ingreso' : 'Salida' }}
              </span>
              <span class="pill muted">Cantidad: {{ m.quantity }}</span>
            </div>
          </div>
        </li>
      </ul>
    </div>
  </div>

  <div class="charts-section">
    <div class="panel chart">
      <div class="panel-header">
        <div>
          <p class="eyebrow">Distribución</p>
          <h3>Stock por Categoría</h3>
        </div>
      </div>
      <canvas id="chartCategory"></canvas>
    </div>

    <div class="panel chart">
      <div class="panel-header">
        <div>
          <p class="eyebrow">Comparativa</p>
          <h3>Productos por Sucursal</h3>
        </div>
      </div>
      <canvas id="chartBranch"></canvas>
    </div>

    <div class="panel chart">
      <div class="panel-header">
        <div>
          <p class="eyebrow">Tendencia</p>
          <h3>Movimientos últimos 30 días</h3>
        </div>
      </div>
      <canvas id="chartMovements"></canvas>
    </div>
  </div>
</div>
